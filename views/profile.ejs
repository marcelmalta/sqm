<!doctype html>
<html>

<head>
    <%- include("partials/head") %>
</head>

<body class="page-enter bg-bg-main text-text-main flex flex-col min-h-screen">
    <%- include("partials/nav", { user }) %>

        <main
            class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full grid grid-cols-1 md:grid-cols-12 gap-8">

            <!-- User Card (Sticky) -->
            <aside class="md:col-span-4 lg:col-span-3">
                <div class="glass rounded-2xl shadow-soft border border-white/60 p-6 sticky top-24 text-center">
                    <div
                        class="w-24 h-24 mx-auto bg-primary/10 rounded-full flex items-center justify-center text-primary text-3xl font-bold mb-4">
                        <%= profileUser.email ? profileUser.email[0].toUpperCase() : '?' %>
                    </div>

                    <h1 class="text-xl font-bold text-text-main mb-1">
                        <%= profileUser.name || profileUser.email %>
                    </h1>

                    <% if (profileUser.role==='admin' ) { %>
                        <span
                            class="inline-block px-2 py-1 bg-red-100 text-red-700 text-xs font-bold uppercase tracking-wider rounded-md mb-4">Administrador</span>
                        <% } else { %>
                            <span
                                class="inline-block px-2 py-1 bg-bg-surface text-text-meta text-xs font-bold uppercase tracking-wider rounded-md mb-4">Membro</span>
                            <% } %>

                                <div class="text-sm text-text-main italic mb-6 leading-relaxed">
                                    "<%= profileUser.bio || 'Sem biografia.' %>"
                                </div>

                                <div class="border-t border-white/10 pt-4 text-xs text-text-meta">
                                    Membro desde <%= new Date(profileUser.created_at).toLocaleDateString('pt-BR') %>
                                </div>

                                <% if (user && user.id===profileUser.id) { %>
                                    <a href="/settings"
                                        class="mt-6 block w-full py-2 border border-white/10 rounded-lg text-sm font-medium hover:bg-bg-card/70 transition-colors">
                                        Editar Perfil
                                    </a>
                                    <% } %>
                </div>
            </aside>

            <!-- Tabs & Content -->
            <div class="md:col-span-8 lg:col-span-9">

                <!-- Tabs -->
                <div
                    class="flex items-center gap-1 bg-bg-card p-1 rounded-xl shadow-sm border border-white/60 mb-6 w-fit">
                    <a href="?tab=topics"
                        class="px-6 py-2 rounded-lg text-sm font-medium transition-colors <%= tab === 'topics' ? 'bg-primary text-white shadow-sm' : 'text-text-meta hover:text-text-main hover:bg-bg-card/70' %>">
                        Tópicos (<%= stats.topics %>)
                    </a>
                    <a href="?tab=comments"
                        class="px-6 py-2 rounded-lg text-sm font-medium transition-colors <%= tab === 'comments' ? 'bg-primary text-white shadow-sm' : 'text-text-meta hover:text-text-main hover:bg-bg-card/70' %>">
                        Comentários (<%= stats.comments %>)
                    </a>
                </div>

                <!-- Content List -->
                <div class="space-y-4">
                    <% if (items.length===0) { %>
                        <div
                            class="glass rounded-2xl p-8 text-center text-text-meta border border-white/60 border-dashed">
                            Nenhum item encontrado nesta categoria.
                        </div>
                        <% } %>

                            <% items.forEach(item=> { %>
                                <% if (tab==='topics' ) { %>
                                    <!-- Topic Item -->
                                    <a href="/t/<%= item.id %>"
                                        class="block glass rounded-2xl border border-white/60 p-4 hover:shadow-soft transition-all group">
                                        <div class="flex items-center justify-between mb-2">
                                            <span class="text-xs font-bold text-primary uppercase">
                                                <%= item.category %>
                                            </span>
                                            <span class="text-xs text-text-meta">
                                                <%= new Date(item.created_at).toLocaleDateString('pt-BR') %>
                                            </span>
                                        </div>
                                        <h3
                                            class="font-bold text-text-main group-hover:text-primary transition-colors mb-1">
                                            <%= item.title %>
                                        </h3>
                                        <p class="text-sm text-text-meta line-clamp-2">
                                            <%= item.body %>
                                        </p>
                                    </a>
                                    <% } else { %>
                                        <!-- Comment Item -->
                                        <div class="glass rounded-2xl border border-white/60 p-4">
                                            <div class="flex items-center gap-2 mb-2 text-xs text-text-meta">
                                                <span>Comentou em</span>
                                                <% if (item.parent_type === 'topic') { %>
                                                    <a href="/t/<%= item.parent_id %>" class="font-medium text-primary hover:underline">
                                                        Topico #<%= item.parent_id %>
                                                    </a>
                                                <% } else { %>
                                                    <% const slug = postSlugById[item.parent_id]; %>
                                                    <% if (slug) { %>
                                                        <a href="/p/<%= slug %>" class="font-medium text-primary hover:underline">
                                                            Post #<%= item.parent_id %>
                                                        </a>
                                                    <% } else { %>
                                                        <span class="font-medium text-text-meta">Post #<%= item.parent_id %></span>
                                                    <% } %>
                                                <% } %>
                                                <span>- <%= new Date(item.created_at).toLocaleDateString('pt-BR') %></span>
                                            </div>
                                            <p class="text-sm text-text-main whitespace-pre-wrap">
                                                <%= item.body %>
                                            </p>
                                        </div>
                                        <% } %>
                                            <% }) %>
                </div>

            </div>
        </main>
</body>

</html>




